(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{E5VM:function(e,t,a){"use strict";var i=a("Kn9g");a.n(i).a},Kn9g:function(e,t,a){},KyeS:function(e,t,a){"use strict";a.r(t);var i=a("Lot7"),r={name:"transfer",data:function(){return{emptyText:"加载中...",tableData:[],goodsList:[],dialogVisible:!1,submitData:{giftId:null,id:null,name:"",propNum:0,type:null},rules:{propNum:[{required:!0,message:"请输入物品数量",trigger:"change"}],id:[{required:!0,message:"请选择物品名称",trigger:"change"}]}}},methods:{addGood:function(){this.dialogVisible=!0,this.getGiftBagGoodsList()},submitForm:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return console.log("error submit!!"),!1;t.$request.fetchAddGoods(t.submitData).then((function(e){200===e.data.code?(t.tableData.push({propId:t.submitData.id,giftId:t.submitData.giftId,propName:t.submitData.name,propNum:t.submitData.propNum,type:null}),t.$message.success("增加物品成功"),t.dialogVisible=!1):t.$message.error("增加物品失败")}))}))},handleClose:function(e){e()},handleDelete:function(e,t){var a=this;this.$request.fetchDelGoods({giftId:this.submitData.giftId,id:t}).then((function(t){200===t.data.code?(a.tableData.splice(e,1),a.$message.success("删除成功")):a.$message.error("删除失败")}))},selectedGood:function(e){var t=this;this.goodsList.some((function(a,i){a.id===e&&(t.submitData.name=a.name)}))},getGiftBagGoods:function(e){var t=this;this.submitData.giftId=e,this.$request.fetchGetGoods({id:e}).then((function(e){200===e.data.code?t.tableData=e.data.data:t.$message.error("数据获取失败"),t.emptyText="暂无数据"}))},getGiftBagGoodsList:function(){var e=this;this.$request.fetchGetGoodsList().then((function(t){200===t.data.code?e.goodsList=t.data.data:e.$message.error("数据获取失败")}))}}},s=a("KHd+"),l=Object(s.a)(r,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-row",[a("el-col",{attrs:{align:"right"}},[a("el-button",{attrs:{type:"primary"},on:{click:e.addGood}},[e._v("新增物品")])],1)],1),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,"empty-text":e.emptyText}},[a("el-table-column",{attrs:{label:"物品id",prop:"propId",width:"100",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"物品名称",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{size:"medium"}},[e._v(e._s(t.row.propName))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"物品数量",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("X"+e._s(t.row.propNum))]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.handleDelete(t.$index,t.row.propId)}}},[e._v("删 除")])]}}])})],1),e._v(" "),[a("el-dialog",{attrs:{title:"新增物品",visible:e.dialogVisible,width:"500px","before-close":e.handleClose},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.submitData,rules:e.rules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"物品名称",prop:"id"}},[a("el-select",{attrs:{placeholder:"请选择物品名称"},on:{change:e.selectedGood},model:{value:e.submitData.id,callback:function(t){e.$set(e.submitData,"id",t)},expression:"submitData.id"}},e._l(e.goodsList,(function(e){return a("el-option",{key:e.id,attrs:{label:e.id+"-"+e.name,value:e.id}})})),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"物品数量",prop:"propNum"}},[a("el-input-number",{attrs:{min:1,max:9e5,label:"物品数量"},model:{value:e.submitData.propNum,callback:function(t){e.$set(e.submitData,"propNum",t)},expression:"submitData.propNum"}})],1),e._v(" "),a("el-form-item",{attrs:{align:"right"}},[a("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("确 定")])],1)],1)],1)]],2)}),[],!1,null,"4287fc72",null).exports,o={name:"giftBagList",components:{giftBag:i.a,giftBagGoods:l},data:function(){return{tableData:[],isLook:!1,isEdit:!1,emptyText:"加载中...",searchPage:{page:1,pageSize:10,giftName:""},totalCount:0,totalPage:0,dialogVisible:!1,tabTitle:"",columnData:[],expands:[]}},methods:{getRowKeys:function(e){return e.id},expandChange:function(e,t){var a=this;t.length>0?(this.expands=[],e&&this.expands.push(e.id),setTimeout((function(){a.$refs.goods.getGiftBagGoods(e.id)}),50)):this.expands=[]},handleClose:function(e){e()},closeCallBack:function(){this.dialogVisible=!1,this.getList(this.searchPage)},lookGiftBag:function(e){var t=this;this.tabTitle="查看礼包",this.dialogVisible=!0,this.isLook=!0,setTimeout((function(){t.$refs.giftBag.getGiftBag(e)}),50)},editGiftBag:function(e){this.isEdit=!0},handleDelete:function(e,t){var a=this;this.$request.fetchDelNews({id:t}).then((function(t){200===t.data.code?(a.tableData.splice(e,1),a.$message.success("删除成功"),0===a.tableData.length&&(a.searchPage.page--,a.getList(a.searchPage))):a.$message.error("删除失败")}))},handleSizeChange:function(e){this.searchPage.pageSize=e,this.getList(this.searchPage)},handleCurrentChange:function(e){this.searchPage.page=e,this.getList(this.searchPage)},onSubmit:function(){this.getList(this.searchPage)},getList:function(e){var t=this;this.$request.fetchGetGiftBagList(e).then((function(e){200===e.data.code?(t.tableData=e.data.data.list,t.searchPage.page=e.data.data.currPage,t.totalCount=e.data.data.totalCount,t.totalPage=e.data.data.totalPage):t.$message.error("数据获取失败"),t.emptyText="暂无数据"}))},filterColumn:function(e,t){return t.gameName===e},getColumn:function(e){var t=this;this.$request.fetchGetGameList(e).then((function(e){200===e.data.code&&e.data.data.list.forEach((function(e){var a={text:"",value:""};a.text=e.name,a.value=e.name,t.columnData.push(a)}))}))}},mounted:function(){this.getList(this.searchPage),this.getColumn({page:1,pageSize:50,gameName:""})},watch:{"searchPage.giftName":{handler:function(e){0===e.length&&(this.searchPage.page=1,this.getList(this.searchPage))}}}},n=(a("E5VM"),Object(s.a)(o,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[[a("el-card",[a("el-row",{attrs:{span:24}},[a("el-col",{attrs:{span:12}},[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.searchPage}},[a("el-form-item",{attrs:{label:"礼包查询"}},[a("el-input",{attrs:{placeholder:"请输入礼包名称查询"},model:{value:e.searchPage.giftName,callback:function(t){e.$set(e.searchPage,"giftName",t)},expression:"searchPage.giftName"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("查询")])],1)],1)],1),e._v(" "),a("el-col",{attrs:{span:12,align:"right"}},[a("router-link",{attrs:{to:"/giftBagAdd"}},[a("el-button",{directives:[{name:"role-btn",rawName:"v-role-btn",value:"143",expression:"'143'"}],attrs:{type:"primary"}},[e._v("新增礼包")])],1)],1)],1)],1),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,"empty-text":e.emptyText,"expand-row-keys":e.expands,"row-key":e.getRowKeys},on:{"expand-change":e.expandChange}},[a("el-table-column",{attrs:{type:"expand"}},[[a("el-card",[a("gift-bag-goods",{ref:"goods"})],1)]],2),e._v(" "),a("el-table-column",{attrs:{label:"ID",width:"150",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticStyle:{"margin-left":"10px"}},[e._v(e._s(t.row.id))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"礼包名称",align:"center",width:"250"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"out-dot"},[e._v(e._s(t.row.giftName))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"gameName",label:"所属游戏",filters:e.columnData,"filter-method":e.filterColumn,"filter-placement":"bottom-end",width:"150",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:"success","disable-transitions":""}},[e._v(e._s(t.row.gameName))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"总数量",width:"150",prop:"giftTotal",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"允许领取次数",width:"150",prop:"limitUse",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"已领取数量",width:"150",prop:"getCount",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"发布时间",width:"200",prop:"createTime",align:"center",sortable:""}}),e._v(" "),a("el-table-column",{attrs:{label:"操作",align:"center",width:"350"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{directives:[{name:"role-btn",rawName:"v-role-btn",value:"144",expression:"'144'"}],attrs:{size:"mini"},on:{click:function(a){return e.lookGiftBag(t.row.id)}}},[e._v("查 看")]),e._v(" "),a("router-link",{attrs:{to:{name:"giftBagEdit",query:{id:t.row.id}}}},[a("el-button",{directives:[{name:"role-btn",rawName:"v-role-btn",value:"145",expression:"'145'"}],attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.editGiftBag()}}},[a("i",{staticClass:"el-icon-edit"}),e._v("编 辑\n            ")])],1),e._v(" "),a("el-button",{directives:[{name:"role-btn",rawName:"v-role-btn",value:"146",expression:"'146'"}],attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.handleDelete(t.$index,t.row.id)}}},[a("i",{staticClass:"el-icon-delete"}),e._v("删 除\n          ")])]}}])})],1)],e._v(" "),[a("el-card",[a("el-pagination",{attrs:{"page-size":e.searchPage.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.totalCount,"prev-text":"上一页","next-text":"下一页"},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],e._v(" "),[a("el-dialog",{attrs:{title:e.tabTitle,visible:e.dialogVisible,width:"750px","before-close":e.handleClose},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("gift-bag",{ref:"giftBag",attrs:{islook:e.isLook}})],1)]],2)}),[],!1,null,"9c68709e",null));t.default=n.exports},Lot7:function(e,t,a){"use strict";var i={name:"giftBag",props:{islook:{type:Boolean,default:!1},isedit:{type:Boolean,default:!1}},data:function(){return{progressFlag:!1,progressPercent:0,gameList:[],ruleForm:{giftName:"",giftDescribe:"",giftTotal:0,getCount:0,limitUse:!1,integralCost:0,cover:"",gameId:null,id:null},rules:{giftName:[{required:!0,message:"请输入礼包名称",trigger:"blur"},{min:1,max:15,message:"长度在 1 到 15 个字符",trigger:"blur"}],giftDescribe:[{required:!0,message:"请输入相关礼包简介",trigger:"blur"}],giftTotal:[{required:!0,message:"礼包总数不能为空",trigger:"change"}],getCount:[{required:!0,message:"礼包已领取数量不能为空",trigger:"change"}],limitUse:[{required:!0,message:"礼包限制领取次数不能为空",trigger:"change"}],integralCost:[{required:!0,message:"领取礼包消耗积分不能为空",trigger:"change"}],cover:[{required:!0,message:"礼包封面不能为空",trigger:"change"}],gameId:[{required:!0,message:"请选择礼包所属游戏",trigger:"change"}]}}},methods:{submitForm:function(e){var t=this;this.$refs[e].validate((function(a){if(!a)return console.log("error submit!!"),!1;t.$request.fetchEditGiftBag(t.ruleForm).then((function(a){200===a.data.code?(t.isedit||t.resetForm(e),t.isedit?t.$message.success("保存成功"):t.$message.success("新增成功")):t.$message.error("保存失败")}))}))},resetForm:function(e){this.$refs[e].resetFields()},handleAvatarSuccess:function(e,t){var a=this;this.ruleForm.cover=e.msg,this.progressPercent=100,setTimeout((function(){a.progressFlag=!1}),1e3)},beforeAvatarUpload:function(e){this.progressFlag=!1;var t=e.size/1024/1024<20;return-1==["image/jpg","image/png","image/gif","image/jpeg"].indexOf(e.type)?(this.$message.error("上传图片只能是jpg|jpeg|png|gif格式!"),!1):t?void 0:(this.$message.error("上传图片大小不能超过 20MB!"),!1)},uploadFileProcess:function(e,t,a){var i=this;a.forEach((function(e){100===e.percentage||(i.progressFlag=!0,i.progressPercent=Math.abs(e.percentage.toFixed(0)))}))},getGiftBag:function(e){var t=this;this.$request.fetchGetGiftBag({id:e}).then((function(e){200===e.data.code?t.ruleForm=e.data.data:500===e.data.code?t.$router.go(-1):t.$message.error("数据获取失败")}))},getGiftBagEdit:function(e){(this.isedit||this.islook)&&this.getGiftBag(e)},getGameData:function(e){var t=this;this.$request.fetchGetGameList(e).then((function(e){200===e.data.code&&e.data.data.list.forEach((function(e){var a={text:"",value:""};a.id=e.id,a.name=e.name,t.gameList.push(a)}))}))}},mounted:function(){this.isedit&&this.getGiftBag(this.$route.query.id),this.getGameData({page:1,pageSize:50,gameName:""})},watch:{$route:{handler:function(e){e&&this.getGiftBagEdit(this.$route.query.id)},deep:!0}}},r=(a("u/4z"),a("KHd+")),s=Object(r.a)(i,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"礼包名称",prop:"giftName"}},[a("el-col",{attrs:{span:12}},[a("el-input",{attrs:{disabled:e.islook,minlength:"1",maxlength:"15","show-word-limit":""},model:{value:e.ruleForm.giftName,callback:function(t){e.$set(e.ruleForm,"giftName",t)},expression:"ruleForm.giftName"}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"所属游戏",prop:"gameId"}},[e.gameList&&e.gameList.length>0?[a("el-select",{attrs:{placeholder:"请选择所属游戏",disabled:e.islook},model:{value:e.ruleForm.gameId,callback:function(t){e.$set(e.ruleForm,"gameId",t)},expression:"ruleForm.gameId"}},e._l(e.gameList,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)]:e._e()],2),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"礼包总数",prop:"giftTotal"}},[a("el-input-number",{attrs:{min:1,max:1e6,precision:0,label:"礼包总数",disabled:e.islook},model:{value:e.ruleForm.giftTotal,callback:function(t){e.$set(e.ruleForm,"giftTotal",t)},expression:"ruleForm.giftTotal"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"已领取数",prop:"getCount"}},[a("el-input-number",{attrs:{min:0,max:1e6,precision:0,label:"已领取数",disabled:e.islook},model:{value:e.ruleForm.getCount,callback:function(t){e.$set(e.ruleForm,"getCount",t)},expression:"ruleForm.getCount"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"最高领取次数",prop:"limitUse"}},[a("el-input-number",{attrs:{min:0,max:1e6,precision:0,label:"最高领取次数",disabled:e.islook},model:{value:e.ruleForm.limitUse,callback:function(t){e.$set(e.ruleForm,"limitUse",t)},expression:"ruleForm.limitUse"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"消耗积分",prop:"integralCost"}},[a("el-input-number",{attrs:{min:0,max:1e6,precision:0,label:"消耗积分",disabled:e.islook},model:{value:e.ruleForm.integralCost,callback:function(t){e.$set(e.ruleForm,"integralCost",t)},expression:"ruleForm.integralCost"}})],1)],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"礼包简介",prop:"giftDescribe"}},[a("el-input",{attrs:{type:"textarea",placeholder:"请输入内容",maxlength:"150","show-word-limit":"",disabled:e.islook},model:{value:e.ruleForm.giftDescribe,callback:function(t){e.$set(e.ruleForm,"giftDescribe",t)},expression:"ruleForm.giftDescribe"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"礼包封面",prop:"cover"}},[a("el-upload",{staticClass:"avatar-uploader",attrs:{action:e.apiUrl+"/upload/uploadFile","show-file-list":!1,"on-success":e.handleAvatarSuccess,"on-progress":e.uploadFileProcess,"before-upload":e.beforeAvatarUpload,disabled:e.islook}},[e.ruleForm.cover?a("img",{staticClass:"avatar",attrs:{src:e.ruleForm.cover}}):a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})]),e._v(" "),a("span",{staticClass:"up-desc"},[e._v("说明: 上传图片大小不能超过20M")]),e._v(" "),e.progressFlag?a("div",{staticClass:"progress-box"},[a("el-progress",{attrs:{percentage:e.progressPercent}})],1):e._e()],1),e._v(" "),e.islook?e._e():a("el-form-item",[e.isedit?a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("保 存")]):a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("新 增")]),e._v(" "),a("el-button",{on:{click:function(t){return e.resetForm("ruleForm")}}},[e._v("重置")])],1)],1)],1)}),[],!1,null,"6784d3b9",null);t.a=s.exports},"iE+Q":function(e,t,a){},"u/4z":function(e,t,a){"use strict";var i=a("iE+Q");a.n(i).a}}]);
//# sourceMappingURL=15.3f07c73211fc036a3411.js.map