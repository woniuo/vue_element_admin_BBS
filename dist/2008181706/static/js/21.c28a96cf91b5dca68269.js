(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{Lot7:function(e,t,r){"use strict";var a={name:"giftBag",props:{islook:{type:Boolean,default:!1},isedit:{type:Boolean,default:!1}},data:function(){return{progressFlag:!1,progressPercent:0,gameList:[],ruleForm:{giftName:"",giftDescribe:"",giftTotal:0,getCount:0,limitUse:!1,integralCost:0,cover:"",gameId:null,id:null},rules:{giftName:[{required:!0,message:"请输入礼包名称",trigger:"blur"},{min:1,max:15,message:"长度在 1 到 15 个字符",trigger:"blur"}],giftDescribe:[{required:!0,message:"请输入相关礼包简介",trigger:"blur"}],giftTotal:[{required:!0,message:"礼包总数不能为空",trigger:"change"}],getCount:[{required:!0,message:"礼包已领取数量不能为空",trigger:"change"}],limitUse:[{required:!0,message:"礼包限制领取次数不能为空",trigger:"change"}],integralCost:[{required:!0,message:"领取礼包消耗积分不能为空",trigger:"change"}],cover:[{required:!0,message:"礼包封面不能为空",trigger:"change"}],gameId:[{required:!0,message:"请选择礼包所属游戏",trigger:"change"}]}}},methods:{submitForm:function(e){var t=this;this.$refs[e].validate((function(r){if(!r)return console.log("error submit!!"),!1;t.$request.fetchEditGiftBag(t.ruleForm).then((function(r){200===r.data.code?(t.isedit||t.resetForm(e),t.isedit?t.$message.success("保存成功"):t.$message.success("新增成功")):t.$message.error("保存失败")}))}))},resetForm:function(e){this.$refs[e].resetFields()},handleAvatarSuccess:function(e,t){var r=this;this.ruleForm.cover=e.msg,this.progressPercent=100,setTimeout((function(){r.progressFlag=!1}),1e3)},beforeAvatarUpload:function(e){this.progressFlag=!1;var t=e.size/1024/1024<20;return-1==["image/jpg","image/png","image/gif","image/jpeg"].indexOf(e.type)?(this.$message.error("上传图片只能是jpg|jpeg|png|gif格式!"),!1):t?void 0:(this.$message.error("上传图片大小不能超过 20MB!"),!1)},uploadFileProcess:function(e,t,r){var a=this;r.forEach((function(e){100===e.percentage||(a.progressFlag=!0,a.progressPercent=Math.abs(e.percentage.toFixed(0)))}))},getGiftBag:function(e){var t=this;this.$request.fetchGetGiftBag({id:e}).then((function(e){200===e.data.code?t.ruleForm=e.data.data:500===e.data.code?t.$router.go(-1):t.$message.error("数据获取失败")}))},getGiftBagEdit:function(e){(this.isedit||this.islook)&&this.getGiftBag(e)},getGameData:function(e){var t=this;this.$request.fetchGetGameList(e).then((function(e){200===e.data.code&&e.data.data.list.forEach((function(e){var r={text:"",value:""};r.id=e.id,r.name=e.name,t.gameList.push(r)}))}))}},mounted:function(){this.isedit&&this.getGiftBag(this.$route.query.id),this.getGameData({page:1,pageSize:50,gameName:""})},watch:{$route:{handler:function(e){e&&this.getGiftBagEdit(this.$route.query.id)},deep:!0}}},i=(r("u/4z"),r("KHd+")),s=Object(i.a)(a,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"120px"}},[r("el-form-item",{attrs:{label:"礼包名称",prop:"giftName"}},[r("el-col",{attrs:{span:12}},[r("el-input",{attrs:{disabled:e.islook,minlength:"1",maxlength:"15","show-word-limit":""},model:{value:e.ruleForm.giftName,callback:function(t){e.$set(e.ruleForm,"giftName",t)},expression:"ruleForm.giftName"}})],1)],1),e._v(" "),r("el-form-item",{attrs:{label:"所属游戏",prop:"gameId"}},[e.gameList&&e.gameList.length>0?[r("el-select",{attrs:{placeholder:"请选择所属游戏",disabled:e.islook},model:{value:e.ruleForm.gameId,callback:function(t){e.$set(e.ruleForm,"gameId",t)},expression:"ruleForm.gameId"}},e._l(e.gameList,(function(e){return r("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)]:e._e()],2),e._v(" "),r("el-row",[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"礼包总数",prop:"giftTotal"}},[r("el-input-number",{attrs:{min:1,max:1e6,precision:0,label:"礼包总数",disabled:e.islook},model:{value:e.ruleForm.giftTotal,callback:function(t){e.$set(e.ruleForm,"giftTotal",t)},expression:"ruleForm.giftTotal"}})],1)],1),e._v(" "),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"已领取数",prop:"getCount"}},[r("el-input-number",{attrs:{min:0,max:1e6,precision:0,label:"已领取数",disabled:e.islook},model:{value:e.ruleForm.getCount,callback:function(t){e.$set(e.ruleForm,"getCount",t)},expression:"ruleForm.getCount"}})],1)],1)],1),e._v(" "),r("el-row",[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"最高领取次数",prop:"limitUse"}},[r("el-input-number",{attrs:{min:0,max:1e6,precision:0,label:"最高领取次数",disabled:e.islook},model:{value:e.ruleForm.limitUse,callback:function(t){e.$set(e.ruleForm,"limitUse",t)},expression:"ruleForm.limitUse"}})],1)],1),e._v(" "),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"消耗积分",prop:"integralCost"}},[r("el-input-number",{attrs:{min:0,max:1e6,precision:0,label:"消耗积分",disabled:e.islook},model:{value:e.ruleForm.integralCost,callback:function(t){e.$set(e.ruleForm,"integralCost",t)},expression:"ruleForm.integralCost"}})],1)],1)],1),e._v(" "),r("el-form-item",{attrs:{label:"礼包简介",prop:"giftDescribe"}},[r("el-input",{attrs:{type:"textarea",placeholder:"请输入内容",maxlength:"150","show-word-limit":"",disabled:e.islook},model:{value:e.ruleForm.giftDescribe,callback:function(t){e.$set(e.ruleForm,"giftDescribe",t)},expression:"ruleForm.giftDescribe"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"礼包封面",prop:"cover"}},[r("el-upload",{staticClass:"avatar-uploader",attrs:{action:e.apiUrl+"/upload/uploadFile","show-file-list":!1,"on-success":e.handleAvatarSuccess,"on-progress":e.uploadFileProcess,"before-upload":e.beforeAvatarUpload,disabled:e.islook}},[e.ruleForm.cover?r("img",{staticClass:"avatar",attrs:{src:e.ruleForm.cover}}):r("i",{staticClass:"el-icon-plus avatar-uploader-icon"})]),e._v(" "),r("span",{staticClass:"up-desc"},[e._v("说明: 上传图片大小不能超过20M")]),e._v(" "),e.progressFlag?r("div",{staticClass:"progress-box"},[r("el-progress",{attrs:{percentage:e.progressPercent}})],1):e._e()],1),e._v(" "),e.islook?e._e():r("el-form-item",[e.isedit?r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("保 存")]):r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("新 增")]),e._v(" "),r("el-button",{on:{click:function(t){return e.resetForm("ruleForm")}}},[e._v("重置")])],1)],1)],1)}),[],!1,null,"6784d3b9",null);t.a=s.exports},b7GU:function(e,t,r){"use strict";r.r(t);var a={name:"giftBagAdd",components:{giftBag:r("Lot7").a},data:function(){return{}}},i=r("KHd+"),s=Object(i.a)(a,(function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("el-card",[t("gift-bag",{attrs:{isedit:!1}})],1)],1)}),[],!1,null,"340ef401",null);t.default=s.exports},"iE+Q":function(e,t,r){},"u/4z":function(e,t,r){"use strict";var a=r("iE+Q");r.n(a).a}}]);
//# sourceMappingURL=21.c28a96cf91b5dca68269.js.map