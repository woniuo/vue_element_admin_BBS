(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{KPpC:function(e,t,r){"use strict";var a=r("R33q");r.n(a).a},R33q:function(e,t,r){},e4vK:function(e,t,r){"use strict";r.r(t);var a=r("GguQ"),s=r.n(a),i={name:"strategyPublish",data:function(){return{editor:null,progressFlag:!1,progressPercent:0,dynamicTags:[],inputVisible:!1,inputValue:"",gameData:[],ruleForm:{title:"",gameId:null,imgPaths:"",labelIds:"",resume:"",content:""},rules:{title:[{required:!0,message:"请输入攻略标题",trigger:"blur"},{min:3,max:30,message:"长度在 3 到 30 个字符",trigger:"blur"}],gameId:[{required:!0,message:"请选择所属游戏",trigger:"change"}],resume:[{required:!0,message:"请输入攻略简介",trigger:"blur"}],content:[{required:!0,message:"攻略内容不能为空",trigger:"blur"}]}}},methods:{submitForm:function(e){var t=this;this.$refs[e].validate((function(r){if(!r)return console.log("error submit!!"),!1;t.$request.fetchAddStrategy(t.ruleForm).then((function(r){200===r.data.code?(t.$message.success("发布成功"),t.resetForm(e)):t.$message.error("发布失败")}))}))},resetForm:function(e){this.$refs[e].resetFields(),this.editor.txt.clear()},handleClose:function(e){this.dynamicTags.splice(this.dynamicTags.indexOf(e),1)},handleAvatarSuccess:function(e,t){var r=this;this.ruleForm.imgPaths=e.msg,this.progressPercent=100,setTimeout((function(){r.progressFlag=!1}),1e3)},beforeAvatarUpload:function(e){this.progressFlag=!1;var t=e.size/1024/1024<20;return-1==["image/jpg","image/png","image/gif","image/jpeg"].indexOf(e.type)?(this.$message.error("上传图片只能是jpg|jpeg|png|gif格式!"),!1):t?void 0:(this.$message.error("上传图片大小不能超过 20MB!"),!1)},uploadFileProcess:function(e,t,r){var a=this;r.forEach((function(e){100===e.percentage||(a.progressFlag=!0,a.progressPercent=Math.abs(e.percentage.toFixed(0)))}))},showInput:function(){var e=this;this.inputVisible=!0,this.$nextTick((function(t){e.$refs.saveTagInput.$refs.input.focus()}))},handleInputConfirm:function(){var e=this,t=this.inputValue;t||t.match(/^\s+$/)?(this.dynamicTags.some((function(e){return e.name==t}))?this.$message.error("此标签已存在"):this.$request.fetchAddTag({name:t}).then((function(t){if(200===t.data.code){e.dynamicTags.push({id:t.data.data.id,name:t.data.data.name});var r=[];e.dynamicTags.some((function(e){r.push(e.id)})),e.ruleForm.labelIds=r.toString()}else e.$message.error("添加失败")})),this.inputVisible=!1,this.inputValue=""):this.$message.error("添加的标签不能为空")},getGameList:function(){var e=this;this.$request.fetchGetGameList().then((function(t){200===t.data.code?e.gameData=t.data.data.list:console.log("所属游戏获取失败")}))}},mounted:function(){var e=this,t=(this.$route.query.articleId,new s.a(this.$refs.editor));this.editor=t,t.customConfig.onchange=function(t){e.ruleForm.content=t},t.create(),this.editor.$textContainerElem.css("height","500px !important"),this.getGameList({page:1,pageSize:50,gameName:""})},watch:{inputValue:function(e){e.match(/^\s+$/)&&this.$message.warning("标签不能为空"),e.length>10&&this.$message.warning("标签最大不能超过10个字")}}},n=(r("KPpC"),r("KHd+")),l=Object(n.a)(i,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-card",[r("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"100px"}},[r("el-row",{attrs:{span:24}},[r("el-col",{attrs:{span:10}},[r("el-form-item",{attrs:{label:"攻略标题",prop:"title"}},[r("el-input",{model:{value:e.ruleForm.title,callback:function(t){e.$set(e.ruleForm,"title",t)},expression:"ruleForm.title"}})],1)],1),e._v(" "),r("el-col",{attrs:{span:6}},[r("el-form-item",{attrs:{label:"所属游戏",prop:"gameId"}},[r("el-select",{attrs:{placeholder:"请选择所属游戏"},model:{value:e.ruleForm.gameId,callback:function(t){e.$set(e.ruleForm,"gameId",t)},expression:"ruleForm.gameId"}},[e.gameData&&e.gameData.length>0?e._l(e.gameData,(function(e){return r("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})):e._e()],2)],1)],1),e._v(" "),r("el-col",{attrs:{span:6,align:"right"}},[r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("发 布")]),e._v(" "),r("el-button",{on:{click:function(t){return e.resetForm("ruleForm")}}},[e._v("重 置")])],1)],1)],1),e._v(" "),r("el-form-item",{attrs:{label:"添加标签",prop:"labelIds"}},[e._l(e.dynamicTags,(function(t){return r("el-tag",{key:t.id,attrs:{closable:"","disable-transitions":!1},on:{close:function(r){return e.handleClose(t)}}},[e._v(e._s(t.name))])})),e._v(" "),e.inputVisible?r("el-input",{ref:"saveTagInput",staticClass:"input-new-tag",attrs:{size:"small"},on:{blur:e.handleInputConfirm},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleInputConfirm(t)}},model:{value:e.inputValue,callback:function(t){e.inputValue=t},expression:"inputValue"}}):r("el-button",{staticClass:"button-new-tag",attrs:{size:"small"},on:{click:e.showInput}},[e._v("+ 标签")])],2),e._v(" "),r("el-form-item",{attrs:{label:"缩略图",prop:"imgPaths"}},[r("el-upload",{staticClass:"avatar-uploader",attrs:{action:e.apiUrl+"/upload/uploadFile","show-file-list":!1,"on-success":e.handleAvatarSuccess,"on-progress":e.uploadFileProcess,"before-upload":e.beforeAvatarUpload}},[e.ruleForm.imgPaths?r("img",{staticClass:"avatar",attrs:{src:e.ruleForm.imgPaths}}):r("i",{staticClass:"el-icon-plus avatar-uploader-icon"})]),e._v(" "),r("span",{staticClass:"up-desc"},[e._v("说明: 上传图片大小不能超过20M")]),e._v(" "),e.progressFlag?r("div",{staticClass:"progress-box"},[r("el-progress",{attrs:{percentage:e.progressPercent}})],1):e._e()],1),e._v(" "),r("el-form-item",{attrs:{label:"攻略简介",prop:"resume"}},[r("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:4},maxlength:"200","show-word-limit":"",placeholder:"请输入攻略简介"},model:{value:e.ruleForm.resume,callback:function(t){e.$set(e.ruleForm,"resume",t)},expression:"ruleForm.resume"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"攻略内容",prop:"content"}},[r("div",{ref:"editor"})])],1)],1)],1)}),[],!1,null,"a6826eb8",null);t.default=l.exports}}]);
//# sourceMappingURL=29.7a00d7276e385d93e159.js.map