(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{X1Kz:function(e,r,t){"use strict";t.r(r);var s=t("GguQ"),o=t.n(s),a={name:"newsPublish",data:function(){return{editor:null,progressFlag:!1,progressPercent:0,emptyText:"加载中...",ruleForm:{title:"",remark:"",cover:"",content:"",id:""},rules:{title:[{required:!0,message:"请输入发布标题",trigger:"blur"},{max:30,message:"标题长度不能超过30个字符串",trigger:"blur"}],remark:[{required:!0,message:"请输入新闻摘要",trigger:"blur"},{max:200,message:"摘要长度不能超过200个字符串",trigger:"blur"}],content:[{required:!0,message:"请输入新闻内容",trigger:"blur"}]}}},methods:{submitForm:function(e){var r=this;this.$refs[e].validate((function(t){if(!t)return console.log("error submit!!"),!1;r.$request.fetchAddNews(r.ruleForm).then((function(t){200===t.data.code?(r.resetForm(e),r.$message.success("发布成功")):r.$message.error("发布失败")}))}))},resetForm:function(e){this.$refs[e].resetFields(),this.ruleForm.cover="",this.editor.txt.clear()},handleAvatarSuccess:function(e,r){var t=this;this.ruleForm.cover=e.msg,this.progressPercent=100,setTimeout((function(){t.progressFlag=!1}),1e3)},beforeAvatarUpload:function(e){this.progressFlag=!1;var r=e.size/1024/1024<20;return-1==["image/jpg","image/png","image/gif","image/jpeg"].indexOf(e.type)?(this.$message.error("上传图片只能是jpg|jpeg|png|gif格式!"),!1):r?void 0:(this.$message.error("上传图片大小不能超过 20MB!"),!1)},uploadFileProcess:function(e,r,t){var s=this;t.forEach((function(e){console.log(e.percentage),100===e.percentage||(s.progressFlag=!0,s.progressPercent=Math.abs(e.percentage.toFixed(0)))}))}},mounted:function(){var e=this,r=(this.$route.query.articleId,new o.a(this.$refs.editor));this.editor=r,r.customConfig.uploadImgServer=this.apiUrl+"/upload/editorUpload",r.customConfig.uploadFileName="file",r.customConfig.onchange=function(r){e.ruleForm.content=r},r.create(),this.editor.$textContainerElem.css("height","500px !important")}},l=(t("gBtj"),t("KHd+")),i=Object(l.a)(a,(function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("div",[t("el-card",[t("el-form",{ref:"ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"标题",prop:"title"}},[t("el-row",{attrs:{span:24}},[t("el-col",{attrs:{span:12}},[t("el-input",{model:{value:e.ruleForm.title,callback:function(r){e.$set(e.ruleForm,"title",r)},expression:"ruleForm.title"}})],1),e._v(" "),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{align:"center"}},[t("el-button",{attrs:{type:"primary"},on:{click:function(r){return e.submitForm("ruleForm")}}},[e._v("发 布")]),e._v(" "),t("el-button",{on:{click:function(r){return e.resetForm("ruleForm")}}},[e._v("重 置")])],1)],1)],1)],1),e._v(" "),t("el-form-item",{attrs:{label:"简介",prop:"remark"}},[t("el-input",{attrs:{type:"textarea",placeholder:"请输入内容",maxlength:"200","show-word-limit":""},model:{value:e.ruleForm.remark,callback:function(r){e.$set(e.ruleForm,"remark",r)},expression:"ruleForm.remark"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"缩略图",prop:"thumbnail"}},[t("el-upload",{staticClass:"avatar-uploader",attrs:{action:e.apiUrl+"/upload/uploadFile","show-file-list":!1,"on-success":e.handleAvatarSuccess,"on-progress":e.uploadFileProcess,"before-upload":e.beforeAvatarUpload}},[e.ruleForm.cover?t("img",{staticClass:"avatar",attrs:{src:e.ruleForm.cover}}):t("i",{staticClass:"el-icon-plus avatar-uploader-icon"})]),e._v(" "),t("span",{staticClass:"up-desc"},[e._v("说明: 上传图片大小不能超过20M")]),e._v(" "),e.progressFlag?t("div",{staticClass:"progress-box"},[t("el-progress",{attrs:{percentage:e.progressPercent}})],1):e._e()],1),e._v(" "),t("el-form-item",{attrs:{label:"主体内容",prop:"content"}},[t("div",{ref:"editor"})])],1)],1)],1)}),[],!1,null,"3fab0aa6",null);r.default=i.exports},an15:function(e,r,t){},gBtj:function(e,r,t){"use strict";var s=t("an15");t.n(s).a}}]);
//# sourceMappingURL=33.2b55e9857dd6f10b5024.js.map