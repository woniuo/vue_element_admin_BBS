(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{"3D43":function(e,t,i){},RRhU:function(e,t,i){"use strict";i.r(t);var o={name:"roleManage",data:function(){return{tableData:[],dialogFormVisible:!1,dialogFormVisible2:!1,isEdit:!1,ruleForm:{description:"",enname:"",name:"",parentId:0,roleCondition:!0},defaultProps:{children:"children",label:"r_name",id:"r_id"},selectRoleId:"",selectData:[],filterText:"",isSpreadAll:!0,defatultSelectedData:[],loading:!0,roleDataAll:[],isSelectedRoleAll:!1,isAssociated:!0,rules:{name:[{required:!0,message:"请输入角色名称",trigger:"blur"},{min:1,max:8,message:"长度在 1 到 8 个字符",trigger:"blur"}],roleCondition:[{required:!0,message:"请选择是否启用",trigger:"change"}]}}},methods:{threeClick:function(){this.isAssociated=!1},isOpenAll:function(){if(this.isSpreadAll){this.isSpreadAll=!1;for(var e=0;e<this.$refs.permission.store._getAllNodes().length;e++)this.$refs.permission.store._getAllNodes()[e].expanded=this.isSpreadAll}else{this.isSpreadAll=!0;for(e=0;e<this.$refs.permission.store._getAllNodes().length;e++)this.$refs.permission.store._getAllNodes()[e].expanded=this.isSpreadAll}},handleEdit:function(e,t){var i=this;this.$request.fetchGetRole({roleId:t.id}).then((function(e){if(200===e.data.code){var t=e.data.data,o=t.id,l=t.description,r=t.enname,s=t.name,a=t.parentId,n=t.roleCondition;i.ruleForm={id:o,description:l,enname:r,name:s,parentId:a,roleCondition:n},i.getList()}else i.$message.error("数据加载失败")})),this.isEdit=!0,this.dialogFormVisible=!0},addRole:function(){this.ruleForm={description:"",enname:"",name:"",parentId:0,roleCondition:!0},this.isEdit=!1,this.dialogFormVisible=!0},addRoleSubmit:function(e){var t=this;this.isEdit?this.$refs[e].validate((function(e){if(!e)return console.log("error submit!!"),!1;t.$request.fetchEditRole(t.ruleForm).then((function(e){200===e.data.code?(t.dialogFormVisible=!1,t.getList(),t.$message.success("修改成功")):t.$message.error("修改失败")}))})):this.$refs[e].validate((function(e){return e?(t.ruleForm.enname||(t.ruleForm.enname=t.randomWord(!0,5,10)),"超级管理员"===t.ruleForm.name?(t.$message.error("超级管理员只能有一个!"),!1):void t.$request.fetchAddRole(t.ruleForm).then((function(e){200===e.data.code?(t.dialogFormVisible=!1,t.getList(),t.$message.success("增加成功")):t.$message.error("增加失败")}))):(console.log("error submit!!"),!1)}))},resetForm:function(e){this.$refs[e].resetFields(),this.ruleForm.description=""},rolePermissionSubmit:function(){var e=this,t=this.$refs.permission.getCheckedKeys(),i=this.$refs.permission.getHalfCheckedKeys(),o={permissionIds:t.concat(i).toString(),roleId:this.selectRoleId};this.$request.fetchRolePermissions(o).then((function(t){200===t.data.code?e.$restBack(t.data,(function(){e.$message.success("修改成功"),e.dialogFormVisible2=!1,e.getList()})):e.$message.error("修改失败")})).catch((function(e){console.log(e)}))},roleEdit:function(e,t){this.selectRoleId=t.id,this.selectData=t.permission?t.permission.split(","):[],this.dialogFormVisible2=!0},setRoleData:function(){var e=this;this.$request.fetchSearchRolePermissions({roleId:this.selectRoleId}).then((function(t){if(200===t.data.code){e.$refs.permission.setCheckedKeys([]);var i=t.data.data.menuArr+","+t.data.data.buttonArr;e.$refs.permission.setCheckedKeys(i.split(",")),e.isAssociated=!1}else e.$message.error("数据加载失败");e.loading=!1}))},selectedRoleAll:function(){if(this.isSelectedRoleAll)this.$refs.permission.setCheckedKeys([]);else{var e=this.roleDataAll.toString();this.$refs.permission.setCheckedKeys(e.split(","))}this.isSelectedRoleAll=!this.isSelectedRoleAll},closeCallBack:function(){this.loading=!0,this.isAssociated=!0},getRoleDataAll:function(){var e=this;this.$request.fetchSearchRolePermissionsAll().then((function(t){if(200===t.data.code){var i=t.data.data.menuArr,o=t.data.data.buttonArr;e.roleDataAll=i.concat(o)}else console.log("接口调取失败")}))},handleDelete:function(e,t){var i=this;this.$request.fetchDelRole({roleId:t.id}).then((function(t){200===t.data.code?(i.tableData.splice(e,1),i.$message({showClose:!0,message:"删除成功",type:"success"})):i.$message.error("删除失败")})).catch((function(e){console.log(e)}))},getList:function(){var e=this;this.$request.fetchGetRoleList().then((function(t){200===t.data.code?e.tableData=t.data.data:e.$message.error("数据加载失败")})).catch((function(e){console.log(e)}))},filterNode:function(e,t){return!e||-1!==t.r_name.indexOf(e)},randomWord:function(e,t,i){var o="",l=t,r=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];e&&(l=Math.round(Math.random()*(i-t))+t);for(var s=0;s<l;s++)o+=r[Math.round(Math.random()*(r.length-1))];return o}},watch:{filterText:function(e){this.$refs.permission.filter(e)}},computed:{roleTree:function(){for(var e=this.$store.getters.roleData,t=0;t<e.length;t++)"/404"===e[t].redirect&&e.splice(t,1);return e}},mounted:function(){this.getList(),this.getRoleDataAll()}},l=(i("oqRS"),i("KHd+")),r=Object(l.a)(o,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"cardshadow roleListTable"},[i("div",[i("el-button",{directives:[{name:"role-btn",rawName:"v-role-btn",value:"106",expression:"'106'"}],attrs:{type:"primary",icon:"el-icon-circle-plus-outline",size:"mini",plain:""},on:{click:e.addRole}},[e._v("新增")])],1),e._v(" "),i("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData}},[i("el-table-column",{attrs:{prop:"id",label:"ID",width:"100"}}),e._v(" "),i("el-table-column",{attrs:{property:"name",label:"角色名",align:"center"}}),e._v(" "),i("el-table-column",{attrs:{property:"description",label:"角色描述",align:"center"}}),e._v(" "),i("el-table-column",{attrs:{prop:"roleCondition",label:"状态","filter-placement":"bottom-end",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[!0===t.row.roleCondition?i("el-tag",{attrs:{type:"primary"}},[e._v("启 用")]):i("el-tag",{attrs:{type:"danger"}},[e._v("禁 用")])]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"操作",width:"300",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{directives:[{name:"role-btn",rawName:"v-role-btn",value:"107",expression:"'107'"}],attrs:{size:"mini",disabled:"超级管理员"==t.row.name},on:{click:function(i){return e.handleEdit(t.$index,t.row)}}},[e._v("编辑")]),e._v(" "),i("el-button",{directives:[{name:"role-btn",rawName:"v-role-btn",value:"108",expression:"'108'"}],attrs:{size:"mini",disabled:"超级管理员"==t.row.name},on:{click:function(i){return e.roleEdit(t.$index,t.row)}}},[e._v("权限分配")]),e._v(" "),i("el-button",{directives:[{name:"role-btn",rawName:"v-role-btn",value:"109",expression:"'109'"}],attrs:{size:"mini",type:"danger",disabled:"超级管理员"==t.row.name},on:{click:function(i){return e.handleDelete(t.$index,t.row)}}},[e._v("删除")])]}}])})],1),e._v(" "),i("el-dialog",{staticClass:"dialog1",attrs:{title:"角色信息",width:"700px",visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[i("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"100px"}},[i("el-form-item",{attrs:{label:"角色名称",prop:"name"}},[i("el-input",{attrs:{type:"text",placeholder:"请输入角色名称",maxlength:"10","show-word-limit":"",autocomplete:"off"},model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"角色描述"}},[i("el-input",{attrs:{placeholder:"请输入角色描述",type:"textarea",maxlength:"50","show-word-limit":"",autocomplete:"off"},model:{value:e.ruleForm.description,callback:function(t){e.$set(e.ruleForm,"description",t)},expression:"ruleForm.description"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"是否开启",prop:"roleCondition"}},[i("el-switch",{model:{value:e.ruleForm.roleCondition,callback:function(t){e.$set(e.ruleForm,"roleCondition",t)},expression:"ruleForm.roleCondition"}})],1)],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){return e.resetForm("ruleForm")}}},[e._v("重 置")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.addRoleSubmit("ruleForm")}}},[e._v("确 定")])],1)],1),e._v(" "),i("el-dialog",{staticClass:"dialog2 hide-relative",attrs:{title:"权限分配",visible:e.dialogFormVisible2},on:{opened:e.setRoleData,"update:visible":function(t){e.dialogFormVisible2=t},close:e.closeCallBack}},[i("div",{staticClass:"three-box"},[e.loading?i("div",{staticClass:"hide-loading"},[i("span",{staticClass:"el-icon-loading"}),e._v("加载中....\n      ")]):e._e(),e._v(" "),i("el-input",{staticStyle:{"margin-bottom":"20px"},attrs:{placeholder:"输入关键字进行过滤"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}}),e._v(" "),i("el-row",[i("el-col",{attrs:{align:"left",span:12}},[i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.isOpenAll}},[e._v("展开/关闭")]),e._v(" "),i("el-button",{attrs:{type:"success",size:"mini"},on:{click:e.selectedRoleAll}},[e._v("一键全选/取消")])],1),e._v(" "),i("el-col",{attrs:{align:"right",span:12}},[i("el-button",{attrs:{size:"mini"},on:{click:function(t){e.dialogFormVisible2=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.rolePermissionSubmit}},[e._v("确 定")])],1)],1),e._v(" "),i("el-tree",{ref:"permission",attrs:{data:e.roleTree,"node-key":"r_id","show-checkbox":"","check-on-click-node":"","default-expand-all":e.isSpreadAll,"highlight-current":"","check-strictly":e.isAssociated,"expand-on-click-node":!1,"filter-node-method":e.filterNode,props:e.defaultProps,"default-checked-keys":e.defatultSelectedData},on:{check:e.threeClick}})],1)])],1)}),[],!1,null,"255acc15",null);t.default=r.exports},oqRS:function(e,t,i){"use strict";var o=i("3D43");i.n(o).a}}]);
//# sourceMappingURL=35.8e93ea4c07e8145d6024.js.map